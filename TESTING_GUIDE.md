# DEX 前端测试指南

## 🎯 测试目标

验证完整的 ve(3,3) DEX 交换功能是否正常工作，包括钱包连接、Token 授权、价格查询和交易执行。

---

## 📋 前置准备

### 1. MetaMask 配置

**添加 BSC Testnet 网络**

```
网络名称: BSC Testnet
RPC URL: https://data-seed-prebsc-1-s1.binance.org:8545/
Chain ID: 97
Currency Symbol: tBNB
Block Explorer: https://testnet.bscscan.com/
```

### 2. 获取测试代币

**步骤 1: 获取 tBNB**
- 访问: https://testnet.bnbchain.org/faucet-smart
- 输入你的钱包地址
- 点击 "Give me BNB"
- 等待 tBNB 到账 (~0.5 tBNB)

**步骤 2: 获取 SOLID Token**

有两种方法:

**方法 A: 使用部署脚本 (推荐)**
```bash
# 从项目根目录
cd /Users/rocky243/Desktop/paimon.dex/designui234
npx hardhat run scripts/transfer-tokens.js --network bscTestnet
```

**方法 B: 手动调用合约**
1. 访问 BSC Testnet 浏览器
2. 找到 SOLID Token 合约地址 (在 .env 中的 VITE_CONTRACT_TOKEN)
3. 使用 `transfer` 函数从部署者地址转账

**步骤 3: 创建 SOLID-WBNB 流动性池 (如果还没有)**

需要先创建交易对并添加初始流动性:

```bash
# 运行流动性池初始化脚本
npx hardhat run scripts/create-pool.js --network bscTestnet
```

或者手动操作:
1. 授权 Router 使用你的 SOLID
2. 调用 Router.addLiquidityETH() 添加 SOLID + BNB 流动性

---

## 🧪 测试流程

### 阶段 1: 界面检查 ✅

**测试内容:**
- [ ] 页面加载无空白
- [ ] 标题显示 "ve(3,3) DEX"
- [ ] 导航按钮显示正确 (Swap / 流动性 / 信息)
- [ ] 右上角显示钱包连接按钮

**预期结果:**
```
页面正常显示
无 JavaScript 错误
样式加载正确
```

**失败处理:**
- 检查浏览器控制台错误
- 确认 Vite 开发服务器正在运行
- 刷新页面并清除缓存

---

### 阶段 2: 钱包连接 🔐

**测试步骤:**
1. 点击右上角 "Connect Wallet" 按钮
2. 在弹出窗口中选择 "MetaMask"
3. 在 MetaMask 中点击 "Next" 和 "Connect"
4. 确认连接成功

**预期结果:**
```
✅ 钱包连接按钮变为地址显示 (0x1234...5678)
✅ 页面顶部显示余额卡片
✅ 显示 SOLID 和 WBNB 余额
```

**检查点:**
- [ ] 地址显示正确
- [ ] SOLID 余额显示 (应该 > 0)
- [ ] WBNB 余额显示 (可能是 0)

**失败处理:**
- 确认 MetaMask 已安装
- 确认已切换到 BSC Testnet
- 检查 .env 配置是否正确

---

### 阶段 3: Token 选择和价格查询 💱

**测试步骤:**

**Test 3.1: 选择 Token**
1. 点击 "卖出" 区域的 Token 选择按钮
2. 查看 Token 列表是否显示
3. 选择 SOLID
4. 点击 "买入" 区域的 Token 选择按钮
5. 选择 WBNB

**预期结果:**
```
✅ Token 列表弹出显示
✅ 显示 SOLID 和 WBNB 两个选项
✅ 选择后按钮文字更新
```

**Test 3.2: 输入金额**
1. 在 "卖出" 输入框中输入 `1`
2. 观察 "买入" 输入框

**预期结果:**
```
✅ "买入" 区域自动显示预估输出金额
✅ 下方显示价格信息 (1 SOLID ≈ X WBNB)
✅ 显示滑点容忍度 (0.5%)
```

**Test 3.3: MAX 按钮**
1. 点击 "卖出" 区域的 "MAX" 按钮

**预期结果:**
```
✅ 输入框自动填充为当前余额
✅ "买入" 金额相应更新
```

**检查点:**
- [ ] Token 选择器正常工作
- [ ] 金额输入只接受数字和小数点
- [ ] 价格实时更新
- [ ] MAX 按钮正确填充余额

**失败处理:**
- 如果价格查询失败，可能是流动性池不存在
- 检查 Router 合约地址是否正确
- 确认 SOLID-WBNB 交易对已创建

---

### 阶段 4: Token 授权 (Approve) ✍️

**测试步骤:**
1. 在 "卖出" 输入框输入 `1` SOLID
2. 观察按钮文字变化

**预期结果:**
```
✅ 按钮显示 "授权 SOLID"
✅ 按钮可点击 (非灰色)
```

3. 点击 "授权 SOLID" 按钮
4. 在 MetaMask 弹窗中查看交易详情

**预期结果:**
```
✅ MetaMask 弹出授权请求
✅ 显示 Spender 为 Router 合约地址
✅ 显示授权金额
```

5. 点击 MetaMask 中的 "确认"
6. 等待交易确认

**预期结果:**
```
✅ 按钮显示 "处理中..." 且禁用
✅ 几秒后按钮恢复
✅ 按钮文字变为 "交换"
```

**检查点:**
- [ ] 授权按钮正确显示
- [ ] MetaMask 正确弹出
- [ ] 交易成功确认
- [ ] 按钮状态自动更新为 "交换"

**失败处理:**
- 如果交易被拒绝，重新点击授权
- 如果 Gas 估算失败，检查合约地址
- 如果一直显示 "处理中"，刷新页面重试

---

### 阶段 5: 执行交换 (Swap) 🔄

**测试步骤:**

**Test 5.1: 正常交换**
1. 确保已完成授权 (按钮显示 "交换")
2. 在 "卖出" 输入 `1` SOLID
3. 确认 "买入" 显示预估的 WBNB 金额
4. 点击 "交换" 按钮

**预期结果:**
```
✅ MetaMask 弹出交易确认
✅ 显示 Gas 费用估算
✅ 显示交易详情
```

5. 在 MetaMask 中点击 "确认"
6. 等待交易确认 (约 10-30 秒)

**预期结果:**
```
✅ 按钮显示 "处理中..." 且禁用
✅ 交易确认后显示 "✅ 交换成功！" 提示
✅ SOLID 余额减少
✅ WBNB 余额增加
✅ 输入框自动清空
```

**Test 5.2: 余额不足**
1. 在 "卖出" 输入框输入超过余额的金额 (如 `999999`)

**预期结果:**
```
✅ 按钮显示 "余额不足"
✅ 按钮被禁用 (灰色)
✅ 无法点击
```

**Test 5.3: 反向交换 (WBNB → SOLID)**
1. 点击中间的 ⇅ 按钮

**预期结果:**
```
✅ "卖出" 和 "买入" Token 互换
✅ 输入金额被清空
✅ 准备进行反向交换
```

2. 输入 WBNB 金额并尝试交换

**预期结果:**
```
✅ 如果 WBNB 余额为 0，显示 "余额不足"
✅ 如果有余额，可以正常执行 WBNB → SOLID 交换
```

**检查点:**
- [ ] 交换按钮正确触发
- [ ] MetaMask 正确显示交易详情
- [ ] 交易成功后余额更新
- [ ] 成功提示显示
- [ ] 输入框自动清空
- [ ] 反向交换正常工作

**失败处理:**
- **Gas 估算失败**: 可能流动性不足或价格滑点过大
- **交易回滚**: 检查流动性池储备量
- **交易卡住**: 等待更长时间或检查区块浏览器
- **余额未更新**: 手动刷新页面

---

### 阶段 6: 边界情况测试 🔍

**Test 6.1: 输入验证**
```
输入: abc123       ❌ 不接受字母
输入: 1.2.3        ❌ 不接受多个小数点
输入: -5           ❌ 不接受负数
输入: 0.00001      ✅ 接受小数
输入: 1000         ✅ 接受大数字
```

**Test 6.2: 极小金额**
1. 输入 `0.000001` SOLID

**预期结果:**
```
✅ 系统接受输入
✅ 价格查询返回结果
✅ 如果流动性充足，可以交换
```

**Test 6.3: 用户拒绝交易**
1. 点击 "授权 SOLID" 或 "交换"
2. 在 MetaMask 中点击 "拒绝"

**预期结果:**
```
✅ 按钮恢复可点击状态
✅ 不显示错误提示
✅ 可以重新尝试
```

**Test 6.4: 网络切换**
1. 在 MetaMask 中切换到其他网络 (如 Ethereum Mainnet)

**预期结果:**
```
✅ Web3Modal 检测到网络变化
✅ 提示切换回 BSC Testnet
✅ 或显示连接断开
```

**Test 6.5: 钱包断开**
1. 点击右上角钱包地址
2. 点击 "Disconnect"

**预期结果:**
```
✅ 钱包地址消失
✅ 余额卡片消失
✅ Swap 按钮显示 "连接钱包" 且禁用
```

---

### 阶段 7: 其他页面测试 📄

**Test 7.1: 流动性页面**
1. 点击导航栏的 "流动性" 按钮

**预期结果:**
```
✅ 页面切换到流动性视图
✅ 显示 "流动性功能" 标题
✅ 显示 "即将推出..." 提示
```

**Test 7.2: 信息页面**
1. 点击导航栏的 "信息" 按钮

**预期结果:**
```
✅ 页面切换到信息视图
✅ 显示 "合约信息" 标题
✅ 显示 4 个合约地址:
   - SOLID Token
   - WBNB
   - Router
   - Factory
✅ 地址显示为缩写格式 (0x1234...5678)
✅ 底部显示 "BSC Testnet (Chain ID: 97)"
```

---

## 📊 测试结果记录

### 功能测试结果

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 页面加载 | ⬜ 待测试 | |
| 钱包连接 | ⬜ 待测试 | |
| Token 选择 | ⬜ 待测试 | |
| 余额显示 | ⬜ 待测试 | |
| 价格查询 | ⬜ 待测试 | |
| MAX 按钮 | ⬜ 待测试 | |
| Token 授权 | ⬜ 待测试 | |
| 交换执行 | ⬜ 待测试 | |
| 余额更新 | ⬜ 待测试 | |
| 成功提示 | ⬜ 待测试 | |
| 反向交换 | ⬜ 待测试 | |
| 输入验证 | ⬜ 待测试 | |
| 余额不足 | ⬜ 待测试 | |
| 错误处理 | ⬜ 待测试 | |
| 流动性页面 | ⬜ 待测试 | |
| 信息页面 | ⬜ 待测试 | |

**状态说明:**
- ✅ 通过
- ❌ 失败
- ⚠️ 部分通过
- ⬜ 待测试

---

## 🐛 Bug 报告模板

如果发现问题，请记录以下信息:

```markdown
### Bug 描述
[清楚描述发生了什么]

### 复现步骤
1.
2.
3.

### 预期行为
[应该发生什么]

### 实际行为
[实际发生了什么]

### 环境信息
- 浏览器: Chrome/Firefox/Safari + 版本
- MetaMask 版本:
- 钱包地址: 0x...
- 交易哈希: 0x... (如果有)
- 控制台错误: [复制错误信息]

### 截图
[如果可能，附上截图]
```

---

## 🔍 调试技巧

### 1. 查看浏览器控制台

打开 Chrome DevTools:
- Mac: `Cmd + Option + J`
- Windows: `Ctrl + Shift + J`

**常见错误类型:**
```javascript
// 合约地址错误
Error: call revert exception

// 授权不足
Error: ERC20: insufficient allowance

// 余额不足
Error: ERC20: transfer amount exceeds balance

// 流动性不足
Error: INSUFFICIENT_OUTPUT_AMOUNT

// 网络错误
Error: network changed
```

### 2. 检查网络请求

在 Chrome DevTools 的 Network 标签:
- 查看是否有失败的 RPC 请求
- 检查返回的错误信息
- 确认 RPC 端点响应正常

### 3. 验证合约交互

在 BSC Testnet 浏览器中:
1. 访问: https://testnet.bscscan.com/
2. 输入你的钱包地址
3. 查看交易历史
4. 检查 Token 余额

### 4. 查看 Router 日志

```javascript
// 在浏览器控制台执行
window.ethereum.request({
  method: 'eth_getLogs',
  params: [{
    address: '<ROUTER_ADDRESS>',
    fromBlock: 'latest'
  }]
})
```

---

## ✅ 测试完成清单

完成所有测试后，确认:

- [ ] 所有核心功能正常工作
- [ ] 没有控制台错误
- [ ] 交易可以成功执行
- [ ] 余额正确更新
- [ ] 错误处理正确
- [ ] UI 响应流畅
- [ ] 所有页面正常显示

---

## 📞 获取帮助

**查看日志:**
```bash
# 查看 Vite 开发服务器日志
cd frontend
npm run dev

# 查看最近的 Git 提交
git log --oneline -5

# 检查环境变量
cat .env
```

**常见问题解决:**

1. **价格查询失败**
   - 确认流动性池已创建
   - 检查 Token 地址配置
   - 验证 Router 合约地址

2. **交易一直 pending**
   - 在 BSC Testnet 浏览器查看交易状态
   - 确认 Gas 设置合理
   - 等待区块确认 (约 3-5 秒)

3. **MetaMask 拒绝连接**
   - 刷新页面重试
   - 重新安装 MetaMask
   - 清除浏览器缓存

4. **余额显示为 0**
   - 确认已获取测试代币
   - 检查网络是否为 BSC Testnet
   - 验证合约地址正确

---

**测试开始日期**: ___________
**测试完成日期**: ___________
**测试人员**: ___________
**测试版本**: feature/interactive-frontend (commit: 9ccdd47)

---

**祝测试顺利！🚀**
